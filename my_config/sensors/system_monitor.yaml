# ############################################################################
# Hardware sensors Z9PA - NVME
# ############################################################################
  - platform: statistics
    entity_id: sensor.nvme0_session_write
    name: nvme0_statistics
    max_age:
      minutes: 60

  - platform: statistics
    entity_id: sensor.nvme1_session_write
    name: nvme1_statistics
    max_age:
      minutes: 60
      
  - platform: statistics
    entity_id: sensor.nvme2_session_write
    name: nvme2_statistics
    max_age:
      minutes: 60

  - platform: statistics
    entity_id: sensor.840pro_session_write
    name: 840pro_statistics
    max_age:
      minutes: 60

  - platform: statistics
    entity_id: sensor.boot_session_write
    name: boot_statistics
    max_age:
      minutes: 60

  - platform: template
    sensors:
      nvme0_write_change_1h:
        value_template: "{{ state_attr('sensor.nvme0_statistics','change') }}"
        unit_of_measurement: 'Gb'
      nvme1_write_change_1h:
        value_template: "{{ state_attr('sensor.nvme1_statistics','change') }}"
        unit_of_measurement: 'Gb'
      nvme2_write_change_1h:
        value_template: "{{ state_attr('sensor.nvme2_statistics','change') }}"
        unit_of_measurement: 'Gb'

      boot_write_change_1h:
        value_template: "{{ state_attr('sensor.boot_statistics','change') }}"
        unit_of_measurement: 'Gb'

      840pro_write_change_1h:
        value_template: "{{ state_attr('sensor.840pro_statistics','change') }}"
        unit_of_measurement: 'Gb'

  - platform: template
    sensors:
      j3455_sda_gb_per_hour:
        friendly_name: j3455 sda Gb per hour
        unit_of_measurement: Gb
        entity_id: sensor.j3455_ssd_session_write, sensor.time
        icon_template: mdi:clock
        value_template: >-
          {% set uptime = states('sensor.j3455_uptime') %}
          {% if uptime | float  > 0 %}
          {{ (states('sensor.j3455_ssd_session_write')|float / states('sensor.j3455_uptime')|float)|round(2) }}
          {% else %}
          {{states('sensor.j3455_ssd_session_write')|float | round(2)}}
          {% endif %}
      j3455_sda_gb_per_day:
        friendly_name: j3455 sda Gb per day
        unit_of_measurement: Gb
        icon_template: mdi:calendar
        entity_id: sensor.j3455_ssd_session_write, sensor.time
        value_template: >-
          {% set uptime = states('sensor.j3455_uptime') %}
          {% if uptime | float  > 0 %}
          {{ (((states('sensor.j3455_ssd_session_write')|float) / (states('sensor.j3455_uptime')|float)*24)|float)|round(2) }}
          {% else %}
          {{ (states('sensor.j3455_ssd_session_write')|float*24) | round(2)}}
          {% endif %}
      j3455_sda_life_left:
        friendly_name: j3455 sda Calculated life left
        unit_of_measurement: years
        entity_id: sensor.j3455_ssd_session_write, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw = 40 %}
          {%set per_day = states('sensor.j3455_sda_gb_per_day')|float%}
          {%set total = states('sensor.j3455_ssd_total_lba_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)*1024/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
          {%endif%}

      rpi_sda_gb_per_hour:
        friendly_name: RPI sda Gb per hour
        unit_of_measurement: Gb
        entity_id: sensor.rpi_ssd_session_write, sensor.time
        icon_template: mdi:clock
        value_template: >-
          {% set uptime = states('sensor.rpi_uptime') %}
          {% if uptime | float  > 0 %}
          {{ (states('sensor.rpi_ssd_session_write')|float / states('sensor.rpi_uptime')|float)|round(2) }}
          {% else %}
          {{states('sensor.rpi_ssd_session_write')|float | round(2)}}
          {% endif %}
      rpi_sda_gb_per_day:
        friendly_name: RPI sda Gb per day
        unit_of_measurement: Gb
        icon_template: mdi:calendar
        entity_id: sensor.rpi_ssd_session_write, sensor.time
        value_template: >-
          {% set uptime = states('sensor.rpi_uptime') %}
          {% if uptime | float  > 0 %}
          {{ (((states('sensor.rpi_ssd_session_write')|float) / (states('sensor.rpi_uptime')|float)*24)|float)|round(2) }}
          {% else %}
          {{ (states('sensor.rpi_ssd_session_write')|float*24) | round(2)}}
          {% endif %}
      rpi_sda_life_left:
        friendly_name: RPI sda Calculated life left
        unit_of_measurement: years
        entity_id: sensor.rpi_ssd_session_write, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw = 40 %}
          {%set per_day = states('sensor.rpi_sda_gb_per_day')|float%}
          {%set total = states('sensor.rpi_ssd_total_lba_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)*1024/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
          {%endif%}

      # boot_gb_per_hour:
      #   friendly_name: sda Gb per hour
      #   unit_of_measurement: Gb
      #   entity_id: sensor.boot_session_write
      #   icon_template: mdi:clock
      #   value_template: >-
      #     {% set uptime = states('sensor.host_uptime') %}
      #     {% if uptime | float  > 0 %}
      #     {{ (states('sensor.boot_session_write')|float / states('sensor.host_uptime')|float)|round(2) }}
      #     {% else %}
      #     {{states('sensor.boot_session_write')|float | round(2)}}
      #     {% endif %}
      # boot_gb_per_day:
      #   friendly_name: sda Gb per day
      #   unit_of_measurement: Gb
      #   icon_template: mdi:calendar
      #   entity_id: sensor.boot_session_write
      #   value_template: >-
      #     {% set uptime = states('sensor.host_uptime') %}
      #     {% if uptime | float  > 0 %}
      #     {{ (((states('sensor.boot_session_write')|float) / (states('sensor.host_uptime')|float)*24)|float)|round(2) }}
      #     {% else %}
      #     {{ (states('sensor.boot_session_write')|float*24) | round(2)}}
      #     {% endif %}
      # boot_life_left:
      #   friendly_name: sda Calculated life left
      #   unit_of_measurement: years
      #   entity_id: sensor.boot_session_write
      #   icon_template: mdi:calendar-clock
      #   value_template: >-
      #     {%set tbw = 40 %}
      #     {%set per_day = states('sensor.boot_gb_per_day')|float%}
      #     {%set total = states('sensor.boot_tb_written')|float%}
      #     {%if per_day == 0 %}
      #     {{ ((tbw-total)*1024/1/365)|round(2)  }}
      #     {%else%}
      #     {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
      #     {%endif%}
      boot_calc_life_left:
        friendly_name: boot Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.boot_tb_written, sensor.boot_power_on_hours, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%if states('sensor.boot_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%set tbw =  160%}
            {%set per_day = (states('sensor.boot_tb_written')|float / states('sensor.boot_power_on_hours')|float)*24%}
            {%set total = states('sensor.boot_tb_written')|float%}

            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}

      # 840pro_1_gb_per_hour:
      #   friendly_name: sdb Gb per hour
      #   unit_of_measurement: Gb
      #   entity_id: sensor.840pro_1_session_write
      #   icon_template: mdi:clock
      #   value_template: >-
      #     {% set uptime = states('sensor.host_uptime') %}
      #     {% if uptime | float  > 0 %}
      #     {{ (states('sensor.840pro_1_session_write')|float / states('sensor.host_uptime')|float)|round(2) }}
      #     {% else %}
      #     {{states('sensor.840pro_1_session_write')|float | round(2)}}
      #     {% endif %}
      # 840pro_1_gb_per_day:
      #   friendly_name: sdb Gb per day
      #   unit_of_measurement: Gb
      #   icon_template: mdi:calendar
      #   entity_id: sensor.840pro_1_session_write
      #   value_template: >-
      #     {{ (states('sensor.840pro_1_gb_per_hour')|float *24) | round(2) }}
      # 840pro_1_life_left:
      #   friendly_name: sdb Calculated life left
      #   unit_of_measurement: years
      #   entity_id: sensor.840pro_1_session_write
      #   icon_template: mdi:calendar-clock
      #   value_template: >-
      #     {%set tbw = 150 %}
      #     {%set per_day = states('sensor.840pro_1_gb_per_day')|float%}
      #     {%set total = states('sensor.840pro_1_tb_written')|float%}
      #     {%if per_day == 0 %}
      #     {{ ((tbw-total)*1024/1/365)|round(2)  }}
      #     {%else%}
      #     {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
      #     {%endif%}
      840pro_1_calc_life_left:
        friendly_name: 840pro Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.840pro_1_tb_written, sensor.840pro_1_power_on_hours, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%if states('sensor.840pro_1_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%set tbw =  160%}
            {%set per_day = (states('sensor.840pro_1_tb_written')|float / states('sensor.840pro_1_power_on_hours')|float)*24%}
            {%set total = states('sensor.840pro_1_tb_written')|float%}

            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}

      # 840pro_2_gb_per_hour:
      #   friendly_name: sdb Gb per hour
      #   unit_of_measurement: Gb
      #   entity_id: sensor.840pro_2_session_write
      #   icon_template: mdi:clock
      #   value_template: >-
      #     {% set uptime = states('sensor.host_uptime') %}
      #     {% if uptime | float  > 0 %}
      #     {{ (states('sensor.840pro_2_session_write')|float / states('sensor.host_uptime')|float)|round(2) }}
      #     {% else %}
      #     {{states('sensor.840pro_2_session_write')|float | round(2)}}
      #     {% endif %}
      # 840pro_2_gb_per_day:
      #   friendly_name: sdb Gb per day
      #   unit_of_measurement: Gb
      #   icon_template: mdi:calendar
      #   entity_id: sensor.840pro_2_session_write
      #   value_template: >-
      #     {{ (states('sensor.840pro_2_gb_per_hour')|float *24) | round(2) }}
      # 840pro_2_life_left:
      #   friendly_name: sdb Calculated life left
      #   unit_of_measurement: years
      #   entity_id: sensor.840pro_2_session_write
      #   icon_template: mdi:calendar-clock
      #   value_template: >-
      #     {%set tbw = 150 %}
      #     {%set per_day = states('sensor.840pro_2_gb_per_day')|float%}
      #     {%set total = states('sensor.840pro_2_tb_written')|float%}
      #     {%if per_day == 0 %}
      #     {{ ((tbw-total)*1024/1/365)|round(2)  }}
      #     {%else%}
      #     {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
      #     {%endif%}
      840pro_2_calc_life_left:
        friendly_name: 840pro Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.840pro_2_tb_written, sensor.840pro_2_power_on_hours, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%if states('sensor.840pro_2_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%set tbw =  160%}
            {%set per_day = (states('sensor.840pro_2_tb_written')|float / states('sensor.840pro_2_power_on_hours')|float)*24%}
            {%set total = states('sensor.840pro_2_tb_written')|float%}

            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}


      nvme0_gb_per_hour:
        friendly_name: NVME0 Gb per hour
        unit_of_measurement: Gb
        entity_id: sensor.nvme0_session_write, sensor.time
        icon_template: mdi:clock
        value_template: >-
          {% set uptime = states('sensor.host_uptime')|float %}
          {% if uptime > 0 %}
          {{ (states('sensor.nvme0_session_write')|float / states('sensor.host_uptime')|float)|round(2) }}
          {% else %}
          {{states('sensor.nvme0_session_write')|float | round(2)}}
          {% endif %}
      nvme0_gb_per_day:
        friendly_name: NVME0 Gb per day
        unit_of_measurement: Gb
        icon_template: mdi:calendar
        entity_id: sensor.nvme0_session_write, sensor.time
        value_template: >-
          {{ (states('sensor.nvme0_gb_per_hour')|float *24) | round(2) }}
      nvme0_life_left:
        friendly_name: NVME0 Calculated life left
        unit_of_measurement: years
        entity_id: sensor.nvme0_session_write, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw = (states('sensor.nvme0_size')|int / 256)*160 %}
          {%set per_day = states('sensor.nvme0_gb_per_day')|float%}
          {%set total = states('sensor.nvme0_tb_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)*1024/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
          {%endif%}
      nvme0_calc_life_left:
        friendly_name: nvme0 Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.nvme0_tb_written, sensor.nvme0_session_write, sensor.nvme0_session_read, sensor.nvme0_power_on_hours, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%if states('sensor.nvme0_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%set tbw = (states('sensor.nvme0_size')|int / 256)*160 %}
            
            {%set per_day = (states('sensor.nvme0_tb_written')|float / states('sensor.nvme0_power_on_hours')|float)*24%}
            {%set total = states('sensor.nvme0_tb_written')|float%}

            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}

      nvme1_gb_per_hour:
        friendly_name: NVME1 Gb per hour
        unit_of_measurement: Gb
        entity_id: sensor.nvme1_session_write, sensor.time
        icon_template: mdi:clock
        value_template: >-
          {% set uptime = states('sensor.host_uptime')|float %}
          {% if uptime > 0 %}
          {{ (states('sensor.nvme1_session_write')|float / states('sensor.host_uptime')|float)|round(2) }}
          {% else %}
          {{states('sensor.nvme1_session_write')|float | round(2)}}
          {% endif %}
      nvme1_gb_per_day:
        friendly_name: NVME1 Gb per day
        unit_of_measurement: Gb
        icon_template: mdi:calendar
        entity_id: sensor.nvme1_session_write, sensor.time
        value_template: >-
          {{ (states('sensor.nvme1_gb_per_hour')|float *24) | round(2) }}
      nvme1_life_left:
        friendly_name: NVME1 Calculated life left
        unit_of_measurement: years
        entity_id: sensor.nvme1_session_write, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw = (states('sensor.nvme1_size')|int / 256)*160 %}
          {%set per_day = states('sensor.nvme1_gb_per_day')|float%}
          {%set total = states('sensor.nvme1_tb_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)*1024/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
          {%endif%}
      nvme1_calc_life_left:
        friendly_name: nvme1 Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.nvme1_tb_written, sensor.nvme1_session_write, sensor.nvme1_session_read, sensor.nvme1_power_on_hours, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%if states('sensor.nvme1_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%set tbw = (states('sensor.nvme1_size')|int / 256)*160 %}
            {%set per_day = (states('sensor.nvme1_tb_written')|float / states('sensor.nvme1_power_on_hours')|float)*24%}
            {%set total = states('sensor.nvme1_tb_written')|float%}

            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}

      nvme2_gb_per_hour:
        friendly_name: NVME2 Gb per hour
        unit_of_measurement: Gb
        entity_id: sensor.nvme2_session_write, sensor.time
        icon_template: mdi:clock
        value_template: >-
          {% set uptime = states('sensor.host_uptime')|float %}
          {% if uptime > 0 %}
          {{ (states('sensor.nvme2_session_write')|float / states('sensor.host_uptime')|float)|round(2) }}
          {% else %}
          {{states('sensor.nvme2_session_write')|float | round(2)}}
          {% endif %}
      nvme2_gb_per_day:
        friendly_name: NVME2 Gb per day
        unit_of_measurement: Gb
        icon_template: mdi:calendar
        entity_id: sensor.nvme2_session_write, sensor.time
        value_template: >-
          {{ (states('sensor.nvme2_gb_per_hour')|float *24) | round(2) }}
      nvme2_life_left:
        friendly_name: NVME2 Calculated life left
        unit_of_measurement: years
        entity_id: sensor.nvme2_session_write, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw = (states('sensor.nvme2_size')|int / 256)*160 %}
          {%set per_day = states('sensor.nvme2_gb_per_day')|float%}
          {%set total = states('sensor.nvme2_tb_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)*1024/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)*1024/per_day/365)|round(2)  }}
          {%endif%}
      nvme2_calc_life_left:
        friendly_name: nvme2 Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.nvme2_tb_written, sensor.nvme2_session_write, sensor.nvme2_session_read, sensor.nvme2_power_on_hours, sensor.time
        icon_template: mdi:calendar-clock
        value_template: >-
          {%if states('sensor.nvme2_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%set tbw = (states('sensor.nvme2_size')|int / 256)*160 %}
            {%set per_day = (states('sensor.nvme2_tb_written')|float / states('sensor.nvme2_power_on_hours')|float)*24%}
            {%set total = states('sensor.nvme2_tb_written')|float%}

            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}


# ############################################################################
# Hardware sensors Z9PA - Internal HA
# ############################################################################
  - platform: cpuspeed

  - platform: systemmonitor
    resources:
      - type: last_boot
      - type: memory_use_percent
      - type: processor_use
      - type: load_1m
      - type: load_5m
      - type: load_15m
      - type: disk_use_percent
        arg: /
  - platform: command_line
    name: CPU Temperature
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "°C"
    value_template: '{{ value | multiply(0.001) | round(0) }}'


  #- platform: command_line
  #  name: GPU Temperature
  #  command: "/opt/vc/bin/vcgencmd measure_temp"
  #  unit_of_measurement: "°C"
  #  value_template: '{{ value | replace("temp=", "") | replace("''C", "") | round(0) }}'

# ############################################################################
# Hardware sensors (RPI) - MQTT
# ############################################################################
  - platform: mqtt
    name: RPI Telemetry Last Update
    state_topic: "rpi/last_update"
    value_template: '{{ value }}'
    expire_after: 150
    icon: mdi:calendar
  
  - platform: mqtt
    name: "RPI Uptime"
    state_topic: "rpi/system_uptime"
    value_template: '{{ ((value | float)/3600) | round(2) }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:timer
    
  - platform: mqtt
    name: "RPI CPU Usage"
    state_topic: "rpi/cpu_percent"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:speedometer
    
  - platform: mqtt
    name: "RPI CPU Temp"
    state_topic: "rpi/sensors_temperatures/cpu-thermal"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    
  - platform: mqtt
    name: "RPI RAM Usage"
    state_topic: "rpi/virtual_memory/percent"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:memory

  - platform: mqtt
    name: "RPI SSD Usage"
    state_topic: "rpi/disk_usage/percent/|"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip

  - platform: mqtt
    name: "RPI SSD Total LBA Written"
    state_topic: "rpi/sda_lba_total"
    value_template: '{{ ( value | float * 512 / 1024 / 1024 / 1024 / 1024) |round(1) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip

  - platform: mqtt
    name: "RPI SSD Session Read"
    state_topic: "rpi/disk_stat/sda_gb_read"
    value_template: '{{ ( value | float ) |round(1) }}'
    unit_of_measurement: 'Gb'
    expire_after: 150
    icon: mdi:alpha-r-box

  - platform: mqtt
    name: "RPI SSD Session Write"
    state_topic: "rpi/disk_stat/sda_gb_write"
    value_template: '{{ ( value | float ) |round(1) }}'
    unit_of_measurement: 'Gb'
    expire_after: 150
    icon: mdi:alpha-w-box

# ############################################################################
# Hardware sensors (j3455) - MQTT
# ############################################################################
  - platform: mqtt
    name: j3455 Telemetry Last Update
    state_topic: "j3455/last_update"
    value_template: '{{ value }}'
    expire_after: 150
    icon: mdi:calendar


  - platform: mqtt
    name: "j3455 Uptime"
    state_topic: "j3455/system_uptime"
    value_template: '{{ ((value | float)/3600) | round(2) }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:timer

  - platform: mqtt
    name: "j3455 CPU Usage"
    state_topic: "j3455/cpu_percent"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:speedometer
    
  - platform: mqtt
    name: "j3455 CPU Temp"
    state_topic: "j3455/sensors_temperatures/coretemp/0"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    
  - platform: mqtt
    name: "j3455 RAM Usage"
    state_topic: "j3455/virtual_memory/percent"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:memory

  - platform: mqtt
    name: "j3455 SSD Usage"
    state_topic: "j3455/disk_usage/percent/|"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip

  - platform: mqtt
    name: "j3455 SSD Total LBA Written"
    state_topic: "j3455/sda_lba_total"
    value_template: '{{ ( value | float * 512 / 1024 / 1024 / 1024 / 1024) |round(1) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip

  - platform: mqtt
    name: "j3455 SSD Session Read"
    state_topic: "j3455/disk_stat/sda_gb_read"
    value_template: '{{ ( value | float ) |round(1) }}'
    unit_of_measurement: 'Gb'
    expire_after: 150
    icon: mdi:alpha-r-box

  - platform: mqtt
    name: "j3455 SSD Session Write"
    state_topic: "j3455/disk_stat/sda_gb_write"
    value_template: '{{ ( value | float ) |round(1) }}'
    unit_of_measurement: 'Gb'
    expire_after: 150
    icon: mdi:alpha-w-box

  - platform: mqtt
    name: "j3455 SSD Temp"
    state_topic: "j3455/disk_temp/sda"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature

# ############################################################################
# Hardware sensors (IPMI) - MQTT
# ###########################################################################
  - platform: mqtt
    name: Ubuntu Telemetry Last Update
    state_topic: "ubuntu/last_update"
    value_template: '{{ value }}'
    expire_after: 150
    icon: mdi:calendar

  - platform: mqtt
    name: Ubuntu Uptime
    state_topic: "ubuntu/system_uptime"
    expire_after: 150
    ##force_update: true
    value_template: '{{ ((value | float)/3600) | round(2) }}'
    unit_of_measurement: 'h'
    icon: mdi:clock-digital

#####################################################    
# Temps
#####################################################
  - platform: mqtt
    name: "71605 CPU Temp"
    state_topic: "ubuntu/71605_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "71605 AFM Temp"
    state_topic: "ubuntu/71605_afm_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "71605 LD Total"
    state_topic: "ubuntu/71605_ld_status"
    value_template: '{{ value.split("/")[0] | int }}'
    unit_of_measurement: ea
    expire_after: 150
    icon: mdi:server-plus
    force_update: true

  - platform: mqtt
    name: "71605 LD Failed"
    state_topic: "ubuntu/71605_ld_status"
    value_template: '{{ value.split("/")[1] | int }}'
    unit_of_measurement: ea
    expire_after: 150
    icon: mdi:server-remove
    force_update: true

  - platform: mqtt
    name: "71605 LD Degraded"
    state_topic: "ubuntu/71605_ld_status"
    value_template: '{{ value.split("/")[2] | int }}'
    unit_of_measurement: ea
    expire_after: 150
    icon: mdi:server-minus
    force_update: true

  - platform: mqtt
    name: "IPMI CPU Temp"
    state_topic: "ubuntu/ipmi/cpu_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI PCH Temp"
    state_topic: "ubuntu/ipmi/pch_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI Peripheral Temp"
    state_topic: "ubuntu/ipmi/peripheral_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI System Temp"
    state_topic: "ubuntu/ipmi/system_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI VcpuVRM Temp"
    state_topic: "ubuntu/ipmi/vcpuvrm_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI VmemABVRM Temp"
    state_topic: "ubuntu/ipmi/vmemabvrm_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI VmemCDVRM Temp"
    state_topic: "ubuntu/ipmi/vmemcdvrm_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI DIMMA1 Temp"
    state_topic: "ubuntu/ipmi/dimma1_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI DIMMB1 Temp"
    state_topic: "ubuntu/ipmi/dimmb1_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI DIMMC1 Temp"
    state_topic: "ubuntu/ipmi/dimmc1_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: "IPMI DIMMD1 Temp"
    state_topic: "ubuntu/ipmi/dimmd1_temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

#####################################################    
# FANs 
#####################################################
  - platform: mqtt
    name: "IPMI Fan1"
    state_topic: "ubuntu/ipmi/fan1"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: 'RPM'
    expire_after: 150
    icon: mdi:fan
    force_update: true

  - platform: mqtt
    name: "IPMI Fan2"
    state_topic: "ubuntu/ipmi/fan2"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: 'RPM'
    expire_after: 150
    icon: mdi:fan
    force_update: true

  - platform: mqtt
    name: "IPMI Fan3"
    state_topic: "ubuntu/ipmi/fan3"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: 'RPM'
    expire_after: 150
    icon: mdi:fan
    force_update: true

  - platform: mqtt
    name: "IPMI Fan4"
    state_topic: "ubuntu/ipmi/fan4"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: 'RPM'
    expire_after: 150
    icon: mdi:fan
    force_update: true

  - platform: mqtt
    name: "IPMI Fan5"
    state_topic: "ubuntu/ipmi/fan5"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: 'RPM'
    expire_after: 150
    icon: mdi:fan
    force_update: true

  - platform: mqtt
    name: "IPMI FanA"
    state_topic: "ubuntu/ipmi/fana"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: 'RPM'
    expire_after: 150
    icon: mdi:fan
    force_update: true

# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - System Stats
# ############################################################################

  - platform: mqtt
    name: "CPU Usage"
    state_topic: "ubuntu/cpu_percent"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:speedometer
    force_update: true
    
  - platform: mqtt
    name: "CPU Package Temp"
    state_topic: "ubuntu/sensors_temperatures/coretemp/0"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true
    
  # - platform: mqtt
  #   name: "CPU2 Package Temp"
  #   state_topic: "ubuntu/sensors_temperatures/coretemp/7"
  #   value_template: '{{ value | int | round(0) }}'
  #   unit_of_measurement: '°C'
  #   expire_after: 150
  #   device_class: temperature

# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - RAM Usage
# ############################################################################
  - platform: mqtt
    name: "RAM Usage"
    state_topic: "ubuntu/virtual_memory/percent"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:memory
    force_update: true

# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - Drives Usage
# ############################################################################
  - platform: mqtt
    name: "SSD Usage"
    state_topic: "ubuntu/disk_usage/md0"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: "NVME_DB Usage"
    state_topic: "ubuntu/disk_usage/nvme_db"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: "840pro Usage"
    state_topic: "ubuntu/disk_usage/840pro"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: "NVME0 Usage"
    state_topic: "ubuntu/disk_usage/nvme0"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: "NVME1 Usage"
    state_topic: "ubuntu/disk_usage/nvme1"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: "NVME2 Usage"
    state_topic: "ubuntu/disk_usage/nvme2"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: "Video Usage"
    state_topic: "ubuntu/disk_usage/video"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:harddisk
    force_update: true

  - platform: mqtt
    name: "Temp Usage"
    state_topic: "ubuntu/disk_usage/temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:harddisk
    force_update: true

  - platform: mqtt
    name: "Media Usage"
    state_topic: "ubuntu/disk_usage/media"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:harddisk
    force_update: true

  - platform: mqtt
    name: "Back_2Tb Usage"
    state_topic: "ubuntu/disk_usage/main"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:harddisk
    force_update: true

  - platform: mqtt
    name: "320l Usage"
    state_topic: "ubuntu/disk_usage/320l"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '%'
    expire_after: 150
    icon: mdi:nas
    force_update: true
    
  # - platform: mqtt
  #   name: "md5 Usage"
  #   state_topic: "ubuntu/disk_usage/md5"
  #   value_template: '{{ value | int | round(0) }}'
  #   unit_of_measurement: '%'
  #   expire_after: 150
  #   icon: mdi:chip

# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - Drives Temperature
# ############################################################################
  - platform: mqtt
    name: NVME0 Temp
    state_topic: "ubuntu/disk_temp/nvme0"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true
    
  - platform: mqtt
    name: NVME1 Temp
    state_topic: "ubuntu/disk_temp/nvme1"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true
    
  - platform: mqtt
    name: NVME2 Temp"
    state_topic: "ubuntu/disk_temp/nvme2"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true
    
  - platform: mqtt
    name: main0 Temp
    state_topic: "ubuntu/disk_temp/main0"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: main1 Temp
    state_topic: "ubuntu/disk_temp/main1"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: main2 Temp
    state_topic: "ubuntu/disk_temp/main2"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: main3 Temp
    state_topic: "ubuntu/disk_temp/main3"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: main4 Temp
    state_topic: "ubuntu/disk_temp/main4"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: main5 Temp
    state_topic: "ubuntu/disk_temp/main5"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: main6 Temp
    state_topic: "ubuntu/disk_temp/main6"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: main7 Temp
    state_topic: "ubuntu/disk_temp/main7"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: Video Temp
    state_topic: "ubuntu/disk_temp/video"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: Temp Temp
    state_topic: "ubuntu/disk_temp/temp"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: boot Temp
    state_topic: "ubuntu/disk_temp/boot"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: 840pro_1 Temp
    state_topic: "ubuntu/disk_temp/840pro_1"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: 840pro_2 Temp
    state_topic: "ubuntu/disk_temp/840pro_2"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: Media1 Temp
    state_topic: "ubuntu/disk_temp/media1"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: Media2 Temp
    state_topic: "ubuntu/disk_temp/media2"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: Media3 Temp
    state_topic: "ubuntu/disk_temp/media3"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true


# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - NVME Size
# ############################################################################
  - platform: mqtt
    name: NVME0 Size
    state_topic: "ubuntu/nvme_size/nvme0"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:file-swap-outline
    force_update: true

  - platform: mqtt
    name: NVME1 Size
    state_topic: "ubuntu/nvme_size/nvme1"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:file-swap-outline
    force_update: true

  - platform: mqtt
    name: NVME2 Size
    state_topic: "ubuntu/nvme_size/nvme2"
    value_template: '{{ value | int | round(0) }}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:file-swap-outline
    force_update: true

# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - SSD Drives Smart Data
# ############################################################################
  - platform: mqtt
    name: NVME0 Tb Written
    state_topic: "ubuntu/ssd_smart/nvme0_lba_written"
    value_template: '{{ ( value | float * 512000 / 1024 / 1024 / 1024 / 1024) |round(1) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: NVME0 Power On Hours
    state_topic: "ubuntu/ssd_smart/nvme0_power_on_hours"
    value_template: '{{ value | int }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:clock-alert-outline
    force_update: true

  - platform: mqtt
    name: NVME1 Tb Written
    state_topic: "ubuntu/ssd_smart/nvme1_lba_written"
    value_template: '{{ ( value | float * 512000 / 1024 / 1024 / 1024 / 1024) |round(1) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: NVME1 Power On Hours
    state_topic: "ubuntu/ssd_smart/nvme1_power_on_hours"
    value_template: '{{ value | int }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:clock-alert-outline
    force_update: true

  - platform: mqtt
    name: NVME2 Tb Written
    state_topic: "ubuntu/ssd_smart/nvme2_lba_written"
    value_template: '{{ ( value | float * 512000 / 1024 / 1024 / 1024 / 1024) |round(1) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: NVME2 Power On Hours
    state_topic: "ubuntu/ssd_smart/nvme2_power_on_hours"
    value_template: '{{ value | int }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:clock-alert-outline
    force_update: true

  - platform: mqtt
    name: boot Tb Written
    state_topic: "ubuntu/ssd_smart/boot_gb_total"
    value_template: '{{ (value| float / 1024) |round(2) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: boot Power On Hours
    state_topic: "ubuntu/ssd_smart/boot_power_on_hours"
    value_template: '{{ value | int }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:clock-alert-outline
    force_update: true

  - platform: mqtt
    name: 840pro_1 Tb Written
    state_topic: "ubuntu/ssd_smart/840pro_1_lba_written"
    value_template: '{{ ( value | float * 512 / 1024 / 1024 / 1024 / 1024) |round(1) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: 840pro_1 Power On Hours
    state_topic: "ubuntu/ssd_smart/840pro_1_power_on_hours"
    value_template: '{{ value | int }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:clock-alert-outline
    force_update: true

  - platform: mqtt
    name: 840pro_2 Tb Written
    state_topic: "ubuntu/ssd_smart/840pro_2_lba_written"
    value_template: '{{ ( value | float * 512 / 1024 / 1024 / 1024 / 1024) |round(1) }}'
    unit_of_measurement: 'Tb'
    expire_after: 150
    icon: mdi:chip
    force_update: true

  - platform: mqtt
    name: 840pro_2 Power On Hours
    state_topic: "ubuntu/ssd_smart/840pro_2_power_on_hours"
    value_template: '{{ value | int }}'
    unit_of_measurement: 'h'
    expire_after: 150
    icon: mdi:clock-alert-outline
    force_update: true


# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - Drives Read\Write Stats
# ############################################################################
  - platform: mqtt
    name: NVME0 Session Write
    state_topic: "ubuntu/disk_stat/nvme0_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box
    force_update: true

  - platform: mqtt
    name: NVME0 Session Read
    state_topic: "ubuntu/disk_stat/nvme0_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box
    force_update: true

  - platform: mqtt
    name: NVME1 Session Write
    state_topic: "ubuntu/disk_stat/nvme1_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box
    force_update: true

  - platform: mqtt
    name: NVME1 Session Read
    state_topic: "ubuntu/disk_stat/nvme1_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box
    force_update: true

  - platform: mqtt
    name: NVME2 Session Write
    state_topic: "ubuntu/disk_stat/nvme2_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box
    force_update: true

  - platform: mqtt
    name: NVME2 Session Read
    state_topic: "ubuntu/disk_stat/nvme2_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box
    force_update: true

  - platform: mqtt
    name: boot Session Write
    state_topic: "ubuntu/disk_stat/boot_gb_write"
    value_template: '{{ value| float | round(1) }}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box
    force_update: true
    
  - platform: mqtt
    name: boot Session Read
    state_topic: "ubuntu/disk_stat/boot_gb_read"
    value_template: '{{ value| float | round(1) }}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box
    force_update: true
    
  - platform: mqtt
    name: 840pro Session Write
    state_topic: "ubuntu/disk_stat/840pro_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box
    force_update: true
    
  - platform: mqtt
    name: 840pro Session Read
    state_topic: "ubuntu/disk_stat/840pro_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box
    force_update: true

  - platform: mqtt
    name: md0 Session Write
    state_topic: "ubuntu/disk_stat/md0_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box
    
  - platform: mqtt
    name: md0 Session Read
    state_topic: "ubuntu/disk_stat/md0_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box

  - platform: mqtt
    name: main Session Write
    state_topic: "ubuntu/disk_stat/main_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box

  - platform: mqtt
    name: main Session Read
    state_topic: "ubuntu/disk_stat/main_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box

  - platform: mqtt
    name: Video Session Write
    state_topic: "ubuntu/disk_stat/video_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box

  - platform: mqtt
    name: Video Session Read
    state_topic: "ubuntu/disk_stat/video_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box

  - platform: mqtt
    name: Media Session Write
    state_topic: "ubuntu/disk_stat/media_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box

  - platform: mqtt
    name: Media Session Read
    state_topic: "ubuntu/disk_stat/media_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box

  - platform: mqtt
    name: Temp Session Write
    state_topic: "ubuntu/disk_stat/temp_gb_write"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-w-box

  - platform: mqtt
    name: Temp Session Read
    state_topic: "ubuntu/disk_stat/temp_gb_read"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: Gb
    expire_after: 150
    icon: mdi:alpha-r-box

# ############################################################################
# Hardware sensors (Ubuntu) - MQTT - MDADM Arrays State
# ############################################################################
  - platform: mqtt
    name: md0 Status
    state_topic: "ubuntu/mdstat/md0"
    value_template: '{{ value }}'
    expire_after: 300
    icon: mdi:harddisk

  - platform: mqtt
    name: md0_disk1
    state_topic: "ubuntu/mdstat/md0_disk1"
    value_template: '{{ value }}'
    expire_after: 300
    icon: mdi:chip

  - platform: mqtt
    name: md0_disk2
    state_topic: "ubuntu/mdstat/md0_disk2"
    value_template: '{{ value }}'
    expire_after: 300
    icon: mdi:chip


  - platform: template
    sensors:
      md0_disk1_template:
        friendly_name: md0 Disk1 dev
        value_template: "{{ states('sensor.md0_disk1') }}"
        icon_template: >
          {%if 'nvme0' in states.sensor.md0_disk1.state %}
              mdi:numeric-0-box
          {%elif 'nvme1' in states.sensor.md0_disk1.state %}
              mdi:numeric-1-box
          {%elif 'nvme2' in states.sensor.md0_disk1.state %}
              mdi:numeric-2-box
          {%elif 'nvme3' in states.sensor.md0_disk1.state %}
              mdi:numeric-3-box
          {%elif 'nvme4' in states.sensor.md0_disk1.state %}
              mdi:numeric-4-box
          {%else%}
              mdi:chip
          {%endif%}

      md0_disk2_template:
        friendly_name: md0 Disk2 dev
        value_template: "{{ states('sensor.md0_disk2') }}"
        icon_template: >
          {%if 'nvme0' in states.sensor.md0_disk2.state %}
              mdi:numeric-0-box
          {%elif 'nvme1' in states.sensor.md0_disk2.state %}
              mdi:numeric-1-box
          {%elif 'nvme2' in states.sensor.md0_disk2.state %}
              mdi:numeric-2-box
          {%elif 'nvme3' in states.sensor.md0_disk2.state %}
              mdi:numeric-3-box
          {%elif 'nvme4' in states.sensor.md0_disk2.state %}
              mdi:numeric-4-box
          {%else%}
              mdi:chip
          {%endif%}

  - platform: mqtt
    name: md0_full
    state_topic: "ubuntu/mdstat/md0_full"
    value_template: '{{ value }}'
    expire_after: 300
    icon: mdi:chip


# ############################################################################
# Hardware sensors (Ubuntu) - PSU HX1200i
# ############################################################################
  - platform: mqtt
    name: PSU Temperature 0
    state_topic: "ubuntu/psu_stat/temp0"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: PSU Temperature 1
    state_topic: "ubuntu/psu_stat/temp1"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: '°C'
    expire_after: 150
    device_class: temperature
    force_update: true

  - platform: mqtt
    name: PSU Total Watts
    state_topic: "ubuntu/psu_stat/total_watts"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: 'W'
    expire_after: 150
    icon: mdi:alpha-w-circle
    force_update: true

  - platform: mqtt
    name: PSU 12v Watts
    state_topic: "ubuntu/psu_stat/12_watts"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: 'W'
    expire_after: 150
    icon: mdi:alpha-w-circle
    force_update: true

  - platform: mqtt
    name: PSU 5v Watts
    state_topic: "ubuntu/psu_stat/5_watts"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: 'W'
    expire_after: 150
    icon: mdi:alpha-w-circle
    force_update: true

  - platform: mqtt
    name: PSU 3v Watts
    state_topic: "ubuntu/psu_stat/3_watts"
    value_template: '{{ value| float| round(1)}}'
    unit_of_measurement: 'W'
    expire_after: 150
    icon: mdi:alpha-w-circle
    force_update: true

  - platform: template
    sensors:
      psu_efficiency:
        friendly_name: PSU Efficiency
        value_template: >
          {% if states('sensor.server_z_hb')|int(-9999) == (-9999)%}
          1
          {%else%}  
          {{ ((states('sensor.psu_total_watts')|float / states('sensor.server_z_hb')|float)*100)|round(1) }}
          {%endif%}
        unit_of_measurement: '%'
        icon_template: mdi:ticket-percent

# ############################################################################
# Hardware sensors - Windows PC
# ############################################################################
##############################################################################################
# BRIX Telemetry
##############################################################################################
  - platform: mqtt
    name: BRIX Telemetry Last Update
    state_topic: "brix/last_update"
    value_template: '{{ value }}'
    icon: mdi:calendar

  - platform: mqtt
    name: BRIX Uptime
    state_topic: "brix/system_uptime"
    qos: 0
    expire_after: 150
    force_update: true
    #value_template: "{{ value }}"
    value_template: "{{ ( value | float ) |round(2) }}"
    unit_of_measurement: 'h'
    icon: mdi:clock-digital

  - platform: mqtt
    name: BRIX SSD Temperature
    state_topic: "brix/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[3].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: BRIX SSD Usage
    state_topic: "brix/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[3].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:chip

  - platform: mqtt
    name: BRIX 860evo Total Gb Written
    state_topic: "brix/smart/860evo_250gb_lba_written"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float * 512 / 1024 / 1024 / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: mqtt
    name: BRIX 860evo Power On Hours
    state_topic: "brix/smart/860evo_250gb_power_on_hours"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  - platform: template
    sensors:
      brix_860evo_gb_per_hour:
        friendly_name: BRIX 860evo gb per hour
        value_template: >
          {%if states('sensor.brix_860evo_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.brix_860evo_total_gb_written')|float / states('sensor.brix_860evo_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      brix_860evo_calc_life_left:
        friendly_name: BRIX 860evo Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.brix_cpu_load
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw = 150*1024%}
          {%set per_day = states('sensor.brix_860evo_gb_per_hour')|float*24%}
          {%set total = states('sensor.brix_860evo_total_gb_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)/per_day/365)|round(2)  }}
          {%endif%}
  - platform: mqtt
    name: BRIX CPU Temperature
    state_topic: "brix/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[0].Children[0].Children[1].Children[1].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: BRIX CPU Fan
    state_topic: "brix/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[0].Children[0].Children[2].Children[0].Value.split(' ')[0] | int }}"
    unit_of_measurement: 'rpm'
    icon: mdi:fan
  
  - platform: mqtt
    name: BRIX AUX Temperature
    state_topic: "brix/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[0].Children[0].Children[1].Children[2].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: BRIX Memory Usage
    state_topic: "brix/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[2].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:memory
    
  - platform: mqtt
    name: BRIX CPU Load
    state_topic: "brix/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:speedometer
    
##############################################################################################
# u430p Telemetry
##############################################################################################
  - platform: mqtt
    name: u430p Telemetry Last Update
    state_topic: "u430p/last_update"
    value_template: '{{ value }}'
    icon: mdi:calendar

  - platform: mqtt
    name: u430p Last Boot
    state_topic: "u430p/last_boot"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value }}"
    #value_template: "{{ ( value | float ) |round(2) }}"
    #unit_of_measurement: 'h'
    icon: mdi:calendar

  - platform: template
    sensors:
      u430p_uptime:
        friendly_name: u430p Uptime
        entity_id: sensor.u430p_cpu_load
        value_template: >
          {%if as_timestamp(strptime(states('sensor.u430p_last_boot'),'%d.%m.%Y %H:%M:%S'))|int(-9999) == (-9999) %}
           0
          {%else%}
           {{((as_timestamp(now())-as_timestamp(strptime(states('sensor.u430p_last_boot'),'%d.%m.%Y %H:%M:%S')))/3600) | round(2)}}
          {%endif%}
        icon_template: mdi:clock-digital 
        unit_of_measurement: 'h'

  - platform: mqtt
    name: u430p SSD Temperature
    state_topic: "u430p/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[4].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: u430p SSD Usage
    state_topic: "u430p/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[4].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:chip

  - platform: mqtt
    name: u430p 840pro Total Gb Written
    state_topic: "u430p/smart/840pro_512gb_lba_written"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float * 512 / 1024 / 1024 / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: mqtt
    name: u430p 840pro Power On Hours
    state_topic: "u430p/smart/840pro_512gb_power_on_hours"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  - platform: template
    sensors:
      u430p_840pro_gb_per_hour:
        friendly_name: u430p 840pro gb per hour
        value_template: >
          {%if states('sensor.u430p_840pro_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.u430p_840pro_total_gb_written')|float / states('sensor.u430p_840pro_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      u430p_840pro_calc_life_left:
        friendly_name: u430p 840pro Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.u430p_cpu_load
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw = 500*1024%}
          {%set per_day = states('sensor.u430p_840pro_gb_per_hour')|float*24%}
          {%set total = states('sensor.u430p_840pro_total_gb_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)/per_day/365)|round(2)  }}
          {%endif%}
  - platform: mqtt
    name: u430p M2 Usage
    state_topic: "u430p/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[5].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:chip
    
  - platform: mqtt
    name: u430p CPU Temperature
    state_topic: "u430p/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[1].Children[2].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: u430p SC2 M2 Total Gb Written
    state_topic: "u430p/smart/sc2_m2_120gb_mb_written"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: mqtt
    name: u430p SC2 M2 Power On Hours
    state_topic: "u430p/smart/sc2_m2_120gb_power_on_hours"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  - platform: template
    sensors:
      u430p_sc2_m2_gb_per_hour:
        friendly_name: u430p SC2 M2 gb per hour
        value_template: >
          {%if states('sensor.u430p_840pro_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.u430p_840pro_total_gb_written')|float / states('sensor.u430p_840pro_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      u430p_sc2_m2_calc_life_left:
        friendly_name: u430p SC2 M2 Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.u430p_840pro_power_on_hours
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw =  40*1024%}
          {%set per_day = states('sensor.u430p_sc2_m2_gb_per_hour')|float*24%}
          {%set total = states('sensor.u430p_sc2_m2_total_gb_written')|float%}
          {%if per_day == 0 %}
          {{ ((tbw-total)/1/365)|round(2)  }}
          {%else%}
          {{ ((tbw-total)/per_day/365)|round(2)  }}
          {%endif%}
  - platform: mqtt
    name: u430p Memory Usage
    state_topic: "u430p/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[2].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:memory
    
  - platform: mqtt
    name: u430p CPU Load
    state_topic: "u430p/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[2].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:speedometer

##############################################################################################
# R418 Telemetry
##############################################################################################
  - platform: mqtt
    name: r418 Telemetry Last Update
    state_topic: "r418/last_update"
    value_template: '{{ value }}'
    icon: mdi:calendar

  - platform: mqtt
    name: r418 Last Boot
    state_topic: "r418/last_boot"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value }}"
    icon: mdi:calendar
  
  - platform: template
    sensors:
      r418_uptime:
        friendly_name: r418 Uptime
        value_template: >
          {%if states('sensor.r418_cpu_load')|int(-9999) == -9999%}
          unknown
          {%else%}
          {{((as_timestamp(now())-as_timestamp(strptime(states('sensor.r418_last_boot'),'%d.%m.%Y %H:%M:%S')))/3600) | round(2)}}
          {%endif%}
        
        
        icon_template: mdi:clock-digital 
        unit_of_measurement: 'h'
    
        
  - platform: mqtt
    name: r418 SSD Usage
    state_topic: "r418/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[4].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:chip  

  - platform: mqtt
    name: r418 SATA SSD Total Gb Written
    state_topic: "r418/smart/sata_ssd_128gb_lba_written"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float * 512 / 1024 / 1024 / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: mqtt
    name: r418 SATA SSD Power On Hours
    state_topic: "r418/smart/sata_ssd_128gb_power_on_hours"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  - platform: template
    sensors:
      r418_sata_ssd_gb_per_hour:
        friendly_name: r418 SATA SSD gb per hour
        value_template: >
          {%if states('sensor.r418_sata_ssd_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.r418_sata_ssd_total_gb_written')|float / states('sensor.r418_sata_ssd_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      r418_sata_ssd_calc_life_left:
        friendly_name: r418 SATA SSD Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.i5_cpu_load
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw =  40*1024%}
          {%set per_day = states('sensor.r418_sata_ssd_gb_per_hour')|float*24%}
          {%set total = states('sensor.r418_sata_ssd_total_gb_written')|float%}
          {%if states('sensor.r418_sata_ssd_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}
  - platform: mqtt
    name: r418 CPU Temperature
    state_topic: "r418/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: >
      {% set cores_temp = value_json.Children[0].Children[1].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int,
                          value_json.Children[0].Children[1].Children[1].Children[1].Value.split(' ')[0].replace(',','.') | int %}
      {{ cores_temp|max }}
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: r418 Memory Usage
    state_topic: "r418/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[2].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:memory
    
  - platform: mqtt
    name: r418 CPU Load
    state_topic: "r418/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[2].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:speedometer

##############################################################################################
# i5 Vova Telemetry
##############################################################################################
  - platform: mqtt
    name: i5 Telemetry Last Update
    state_topic: "i5vova/last_update"
    value_template: '{{ value }}'
    icon: mdi:calendar

  - platform: mqtt
    name: i5 Uptime
    state_topic: "i5vova/system_uptime"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float ) |round(2) }}"
    unit_of_measurement: 'h'
    icon: mdi:clock-digital

  - platform: mqtt
    name: i5 SSD Temperature
    state_topic: "i5vova/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[3].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: i5 SSD Usage
    state_topic: "i5vova/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[3].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:chip    

  - platform: mqtt
    name: i5 bx500 Total Gb Written
    state_topic: "i5vova/smart/bx500_120gb_lba_written"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float * 512 / 1024 / 1024 / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: mqtt
    name: i5 bx500 Power On Hours
    state_topic: "i5vova/smart/bx500_120gb_power_on_hours"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  - platform: template
    sensors:
      i5_bx500_gb_per_hour:
        friendly_name: i5 bx500 gb per hour
        value_template: >
          {%if states('sensor.i5_bx500_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.i5_bx500_total_gb_written')|float / states('sensor.i5_bx500_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      i5_bx500_calc_life_left:
        friendly_name: i5 bx500 Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.i5_cpu_load
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw =  40*1024%}
          {%set per_day = states('sensor.i5_bx500_gb_per_hour')|float*24%}
          {%set total = states('sensor.i5_bx500_total_gb_written')|float%}
          {%if states('sensor.i5_bx500_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}
  - platform: mqtt
    name: i5 CPU Temperature
    state_topic: "i5vova/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[1].Children[4].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: i5 Memory Usage
    state_topic: "i5vova/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[2].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:memory
    
  - platform: mqtt
    name: i5 CPU Load
    state_topic: "i5vova/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[2].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:speedometer

  - platform: mqtt
    name: i5 CPU Fan
    state_topic: "i5vova/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[0].Children[0].Children[2].Children[0].Value.split(' ')[0] | int }}"
    unit_of_measurement: 'rpm'
    icon: mdi:fan

  - platform: mqtt
    name: i5 Case Fan
    state_topic: "i5vova/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[0].Children[0].Children[2].Children[1].Value.split(' ')[0] | int }}"
    unit_of_measurement: 'rpm'
    icon: mdi:fan
    
##############################################################################################
# Dell 5490 Telemetry
##############################################################################################
  - platform: mqtt
    name: 5490 Telemetry Last Update
    state_topic: "5490/last_update"
    value_template: '{{ value }}'
    icon: mdi:calendar

  - platform: mqtt
    name: 5490 Uptime
    state_topic: "5490/system_uptime"
    qos: 0
    expire_after: 350
    force_update: true
    value_template: "{{ ( value | float ) |round(2) }}"
    unit_of_measurement: 'h'
    icon: mdi:clock-digital

  # - platform: mqtt
  #   name: 5490 SC401 Temperature
  #   state_topic: "5490/telemetry"
  #   qos: 0
  #   expire_after: 350
  #   force_update: true
  #   value_template: "{{ value_json.Children[0].Children[3].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
  #   unit_of_measurement: '°C'
  #   device_class: temperature

  - platform: mqtt
    name: 5490 SC401 Total Gb Written
    state_topic: "5490/smart/sc401_256gb_total_lba_written"
    qos: 0
    expire_after: 350
    force_update: true
    value_template: "{{ ( value | float * 512 / 1024 / 1024 / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: template
    sensors:
      5490_sc401_gb_per_hour:
        friendly_name: 5490 SC401 Gb per hour
        value_template: >
          {%if states('sensor.5490_sc401_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.5490_sc401_total_gb_written')|float / states('sensor.5490_sc401_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      
      5490_sc401_calc_life_left:
        friendly_name: 5490 SC401 Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.5490_cpu_load
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw =  120*1024%}
          {%set per_day = states('sensor.5490_sc401_gb_per_hour')|float*24%}
          {%set total = states('sensor.5490_sc401_total_gb_written')|float%}
          {%if states('sensor.5490_sc401_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}
        
  - platform: mqtt
    name: 5490 SC401 Power On Hours
    state_topic: "5490/smart/sc401_256gb_power_on_hours"
    qos: 0
    expire_after: 350
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  # - platform: mqtt
  #   name: 5490 SC401 Usage
  #   state_topic: "5490/telemetry"
  #   qos: 0
  #   expire_after: 350
  #   force_update: true
  #   value_template: "{{ value_json.Children[0].Children[3].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
  #   unit_of_measurement: '%'
  #   icon: mdi:chip
    
  # - platform: mqtt
  #   name: 5490 CPU Temperature
  #   state_topic: "5490/telemetry"
  #   qos: 0
  #   expire_after: 350
  #   force_update: true
  #   value_template: "{{ value_json.Children[0].Children[1].Children[1].Children[4].Value.split(' ')[0].replace(',','.') | int }}"
  #   unit_of_measurement: '°C'
  #   device_class: temperature

  # - platform: mqtt
  #   name: 5490 Memory Usage
  #   state_topic: "5490/telemetry"
  #   qos: 0
  #   expire_after: 350
  #   force_update: true
  #   value_template: "{{ value_json.Children[0].Children[2].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
  #   unit_of_measurement: '%'
  #   icon: mdi:memory
    
  # - platform: mqtt
  #   name: 5490 CPU Load
  #   state_topic: "5490/telemetry"
  #   qos: 0
  #   expire_after: 350
  #   force_update: true
  #   value_template: "{{ value_json.Children[0].Children[1].Children[2].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
  #   unit_of_measurement: '%'
  #   icon: mdi:speedometer

##############################################################################################
# Dell m6800 Telemetry
##############################################################################################
  - platform: mqtt
    name: m6800 Telemetry Last Update
    state_topic: "m6800/last_update"
    value_template: '{{ value }}'
    icon: mdi:calendar

  - platform: mqtt
    name: m6800 Uptime
    state_topic: "m6800/system_uptime"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float ) |round(2) }}"
    unit_of_measurement: 'h'
    icon: mdi:clock-digital

  - platform: mqtt
    name: m6800 Drive E Temperature
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[6].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature  

  - platform: mqtt
    name: m6800 860pro Total Gb Written
    state_topic: "m6800/smart/860pro_512gb_lba_written"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float * 512 / 1024 / 1024 / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: mqtt
    name: m6800 860pro Power On Hours
    state_topic: "m6800/smart/860pro_512gb_power_on_hours"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  - platform: template
    sensors:
      m6800_860pro_gb_per_hour:
        friendly_name: m6800 860pro gb per hour
        value_template: >
          {%if states('sensor.m6800_860pro_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.m6800_860pro_total_gb_written')|float / states('sensor.m6800_860pro_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      m6800_860pro_calc_life_left:
        friendly_name: m6800 860pro Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.m6800_cpu_load
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw =  600*1024%}
          {%set per_day = states('sensor.m6800_860pro_gb_per_hour')|float*24%}
          {%set total = states('sensor.m6800_860pro_total_gb_written')|float%}
          {%if states('sensor.m6800_860pro_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}
  - platform: mqtt
    name: m6800 840evo Total Gb Written
    state_topic: "m6800/smart/840evo_500gb_lba_written"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | float * 512 / 1024 / 1024 / 1024 ) |round(1) }}"
    unit_of_measurement: 'Gb'
    icon: mdi:chip

  - platform: template
    sensors:
      m6800_840evo_gb_per_hour:
        friendly_name: m6800 840evo gb per hour
        value_template: >
          {%if states('sensor.m6800_840evo_power_on_hours')|float(-9999) == -9999%}
          0
          {%else%}
          {{(states('sensor.m6800_840evo_total_gb_written')|float / states('sensor.m6800_840evo_power_on_hours')|float)|round(2)}}
          {%endif%}
        icon_template: mdi:chip
        unit_of_measurement: 'Gb\h'
      m6800_840evo_calc_life_left:
        friendly_name: m6800 840evo Calculated Life Left
        unit_of_measurement: years
        entity_id: sensor.m6800_cpu_load
        icon_template: mdi:calendar-clock
        value_template: >-
          {%set tbw =  72*1024%}
          {%set per_day = states('sensor.m6800_840evo_gb_per_hour')|float*24%}
          {%set total = states('sensor.m6800_840evo_total_gb_written')|float%}
          {%if states('sensor.m6800_840evo_power_on_hours')|float(-9999) == -9999%}
          unknown
          {%else%}
            {%if per_day == 0 %}
            {{ ((tbw-total)/1/365)|round(2)  }}
            {%else%}
            {{ ((tbw-total)/per_day/365)|round(2)  }}
            {%endif%}
          {%endif%}
          
  - platform: mqtt
    name: m6800 840evo Power On Hours
    state_topic: "m6800/smart/840evo_500gb_power_on_hours"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ ( value | int) }}"
    unit_of_measurement: 'h'
    icon: mdi:timer

  - platform: mqtt
    name: m6800 Drive E Usage
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[6].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:harddisk

  - platform: mqtt
    name: m6800 Drive C Temperature
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[7].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: m6800 Drive C Usage
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[7].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon:  mdi:chip

  - platform: mqtt
    name: m6800 Drive D Temperature
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[4].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: m6800 Drive D Usage
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[4].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:harddisk

  - platform: mqtt
    name: m6800 Drive F Temperature
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[5].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: m6800 Drive F Usage
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[5].Children[1].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon:  mdi:chip

  - platform: mqtt
    name: m6800 CPU Temperature
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[1].Children[4].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '°C'
    device_class: temperature

  - platform: mqtt
    name: m6800 Memory Usage
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[2].Children[0].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%'
    icon: mdi:memory
    
  - platform: mqtt
    name: m6800 CPU Load
    state_topic: "m6800/telemetry"
    qos: 0
    expire_after: 150
    force_update: true
    value_template: "{{ value_json.Children[0].Children[1].Children[2].Children[0].Value.split(' ')[0].replace(',','.') | int }}"
    unit_of_measurement: '%' 
    icon: mdi:speedometer

#  - platform: rest
#    name: cont0_cpu_load
#    resource: http://192.168.1.14:61208/api/3/docker
#    value_template: '{{ value_json["containers"][0].cpu_percent | round(0) }}'
#    unit_of_measurement: "%"
#    scan_interval: 5
#  - platform: rest
#    name: cont0_mem_usage
#    resource: http://192.168.1.14:61208/api/3/docker
#    value_template: '{{ ( value_json["containers"][0].memory.usage / 1024 / 1024 ) | int }}'
#    unit_of_measurement: "Mb"
#    scan_interval: 5
#  - platform: rest
#    name: cont0_name
#    resource: http://192.168.1.14:61208/api/3/docker
#    value_template: '{{ value_json["containers"][0].name }}'
#    scan_interval: 30